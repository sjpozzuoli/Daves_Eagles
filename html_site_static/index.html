<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sweet City Finder</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel='stylesheet' type='text/css'>
    <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; background:black;}
    svg { width:100%; height: 100% }
    path {fill:none;color:#fff;}
    .graticule {
      fill: none;
      stroke: #bbb;
      stroke-width: .5px;
      stroke-opacity: .5;
    }

      circle {
        stroke: red;
        fill: rgba(0,0, 0, 0.2);
      }

      circle:hover { 
        stroke-width: 2px;
      }

      .d3-tip {
        font-family: 'Raleway', sans-serif;
        font-size: 1.5em;
        line-height: 1;
        padding: 7px;
        background: black;
        color: lightgray;
        border-radius: 20px;
      }
    </style>
</head>

<body>
  <script>
      
    var xColumn = "longitude";
    var yColumn = "latitude";
    var rColumn = "class";
    var classPerPixel = .0001;
    
var width = 960,
  height = 580;

var projection = d3.geoMercator();

var path = d3.geoPath().projection(projection);

var graticule = d3.geoGraticule();

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

svg.append("defs").append("path")
  .datum({type: "Sphere"})
  .attr("id", "sphere")
  .attr("d", path);

svg.append("use")
  .attr("class", "stroke")
  .attr("xlink:href", "#sphere");

svg.append("use")
  .attr("class", "fill")
  .attr("xlink:href", "#sphere");

svg.append("path")
  .datum(graticule)
  .attr("class", "graticule")
  .attr("d", path);

d3.json("https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/world-50m.json", function(error, world) {
if (error) throw error;

var countries = topojson.feature(world, world.objects.countries).features,
    neighbors = topojson.neighbors(world.objects.countries.geometries);

svg.selectAll(".country")
    .data(countries)
  .enter().insert("path", ".graticule")
    .attr("class", "country")
    .attr("d", path)
    .style("fill", "#fff");
    
    
    
    
    var classFormat = d3.format(",");

    var tip = d3.tip()
      .attr("class", "d3-tip")
      .offset([-10, 0])
      .html(function(d) {
        return d.name + ": " + classFormat(d.class);
      });

    svg.call(tip);

    var rScale = d3.scaleSqrt();

    function render(data){

      rScale.domain([0, d3.max(data, function (d){ return d[rColumn]; })]);

      // Compute the size of the biggest circle as a function of peoplePerPixel.
      var classMax = rScale.domain()[1];
      var rMin = 0;
      var rMax = Math.sqrt(peopleMax / (classPerPixel * Math.PI));
      rScale.range([rMin, rMax]);
      
      var circles = svg.selectAll("circle").data(data);
    circles.enter().append("svg:circle")
        .attr("cx", function (d){ return projection([d[xColumn],d[yColumn]])[0]; })
        .attr("cy", function (d){ return projection([d[xColumn],d[yColumn]])[1]; })      
        .attr("r",  function (d){ return rScale(d[rColumn]); })
        .on("mouseover", tip.show)
        .on("mouseout", tip.hide);      
      circles.exit().remove();
      
      
    }

    function type(d){
      d.latitude = +d.latitude;
      d.longitude = +d.longitude;
      d.class = +d.class;
      return d;
    }
    

    d3.csv("https://raw.githubusercontent.com/sjpozzuoli/Daves_Eagles/main/Data_Main/data_clusters_latlong_ready.csv", type, render);

});

d3.select(self.frameElement).style("height", height + "px");

  
  </script>
  <div class="container">
    <div class="row">
      <div class="col-md-12 jumbotron text-center">
        <h1>Sweet City Finder</h1>
        <p>Use the interactive charts below to find the Next Hottest City</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <div class="well">
          <h5>Select a City:</h5>
          <!-- <select id="selDataset"></select> -->
          <select id="selDataset" onchange="optionChanged(this.value)"></select>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">Demographic Info</h3>
          </div>
          <div id="sample-metadata" class="panel-body"></div>
           
        </div>
      </div>
      <div class="col-md-5">
        <div id="bar"></div>
      </div>
      <div class="col-md-5">
        <div id="gauge"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div id="bubble"></div>
      </div>
    </div>
  </div>

  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="js/plots.js"></script>

</body>

</html>
